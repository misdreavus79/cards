/*! cards - v1.0.0 - 2015-08-02
* https://github.com/misdreavus79/cards#readme
* Copyright (c) 2015 ; Licensed  */

"use strict";var Memory={currentLevel:0,currentElements:[],clearLevel:{current:0,target:50,full:!1,execute:function(){this.full&&($(".tile").each(function(){$(this).hasClass("active")||$(this).addClass("active")}),this.full=!1,this.current=0,$("#clearLevel").val(this.current),Memory.win=!0,Memory.end(Memory.levels[Memory.currentLevel].type))}},wildcard:{current:0,target:30,full:!1,execute:function(){if(this.full){if(!Memory.slot)return void alert("select a card first");var a=$('button[data="'+Memory.slot+'"]').not(".active");Memory.reveal(a),this.full=!1,this.current=0,$("#wildcard").val(this.current)}}},showBoard:{current:0,target:40,full:!1,execute:function(){this.full&&($(".tile").each(function(){$(this).hasClass("active")||$(this).addClass("active")}),setTimeout(function(){$(".tile").each(function(){$(this).hasClass("locked")||$(this).removeClass("active")})},2e3),this.full=!1,this.current=0,$("#showBoard").val(this.current))}},extraTime:{current:0,target:20,full:!1,execute:function(){this.full&&"time"===Memory.levels[Memory.currentLevel]&&(Memory.levels[Memory.currentLevel].targetSeconds+=20,this.full=!1,this.current=0,$("#extraTime").val(this.current))}},extraMoves:{current:0,target:20,full:!1,execute:function(){if(!this.full||"moves"!==Memory.levels[Memory.currentLevel])return void console.log("not full");var a=Memory.levels[Memory.currentLevel].targetMoves+=10;$("#moves").text(a),this.full=!1,this.current=0,$("#extraMoves").val(this.current)}},win:!1,lives:3,score:0,slot:!1,currentMatches:0,respawnCounter:0,currentMoves:0,currentSeconds:0,colors:["blue","red","pink","green","orange","black"],shapes:["circle","square","triangle","diamond","heart","crown1","star","crown2","moon","crown3","spade","club"],display:function(){$("#board").html("");for(var a=1,b=0,c=0,d=1;d<=this.levels[this.currentLevel].numberOfTiles;d++)if(this.currentElements[d-1]='<td><button class="tile" data="'+a+'"><img src="shapes/'+this.shapes[c]+"-"+this.colors[b]+'.png"></button></td>',d%2===0&&(a++,5===b&&(c++,b=0),b++),d===this.levels[this.currentLevel].numberOfTiles){this.currentElements.sort(function(){return Math.random()-.5});for(var e="<tr>",f=1;f<=this.currentElements.length;f++)e+=this.currentElements[f-1],f%4===0&&(e+=f<this.currentElements.length?"</tr><tr>":"</tr>")}$("#board").html(e),this.respawnCounter=a},shuffle:function(){this.currentElements.sort(function(){return Math.random()-.5}),$("#board").fadeOut(500,function(){$("#board").html(this.currentElements),$(".tile").click(function(){Memory.reveal($(this))})}),$("#board").fadeIn(500),this.slot=!1},countdown:function(){this.win||($("#time").html(this.currentSeconds),this.currentSeconds>0?(this.currentSeconds-=1,setTimeout(function(){this.countdown()}.bind(this),1e3)):this.end("time"))},trackMoves:function(){this.currentMoves===this.levels[this.currentLevel].targetMoves&&this.end("moves");var a=this.levels[this.currentLevel].targetMoves-this.currentMoves;$("#moves").text(a)},trackScore:function(){this.score>=this.levels[this.currentLevel].targetScore&&(this.win=!0,this.end("score"))},reveal:function(a){switch(this.currentMoves+=1,this.levels[this.currentLevel].type){case"time":break;case"score":this.trackScore();break;case"moves":this.trackMoves()}a.hasClass("active")||a.hasClass("locked")||(a.removeClass("hidden"),a.addClass("active"),this.slot?this.match(a.attr("data")):this.slot=a.attr("data"))},match:function(a){this.slot===a?("Match!"===$("#message").text()?$("#message").addClass("accent"):$("#message").text("Match!"),setTimeout(function(){$(".active").addClass("locked").removeClass("active"),$("#message").hasClass("accent")&&$("#message").removeClass("accent")},500),this.score+=100,$("#score").text(this.score),this.trackMatches()):("Not a Match!"===$("#message").text()?$("#message").addClass("accent"):$("#message").text("Not a Match!"),setTimeout(function(){$(".active").addClass("hidden").removeClass("active"),$("#message").hasClass("accent")&&$("#message").removeClass("accent")},500)),this.slot=!1},respawn:function(){setTimeout(function(){var a=$(".locked").first();return a.length<=0?(console.log("nothing"),void this.shuffle()):(console.log(a),a.remove(),void this.respawn())}.bind(this),300)},trackMatches:function(){this.currentMatches+=1,this.fillBars(),this.currentMatches===this.levels[this.currentLevel].targetMatches&&(this.win=!0,this.end(this.levels[this.currentLevel].type))},start:function(){switch(this.win=!1,this.score=0,this.currentMoves=0,this.currentMatches=0,this.display(),$("#title").text("Level "+(this.currentLevel+1)),$("#message").text(this.levels[this.currentLevel].levelMessage),$("#score").text(this.score),$(".tile").click(function(){Memory.reveal($(this))}),this.currentLevel%10===0&&this.updateBars(),this.levels[this.currentLevel].type){case"time":this.currentSeconds=this.levels[this.currentLevel].targetSeconds,this.countdown();break;case"moves":$("#moves").text(this.levels[this.currentLevel].targetMoves)}$("#shuffle").prop("disabled",!1),$("#reset").prop("disabled",!0).css("opacity",".5")},end:function(a){if(this.win){switch($("#message").html("Onward!"),$("#reset").val("Next Level"),a){case"time":this.score*=this.levels[this.currentLevel].targetSeconds,$("#score").text(this.score);break;case"moves":this.score*=this.levels[this.currentLevel].targetMoves,$("#score").text(this.score)}this.currentLevel+=1}else $("#message").html("Almost..."),$("#reset").text("Play Again");$("#shuffle").prop("disabled",!0),$("#reset").prop("disabled",!1).css("opacity","1")},updateBars:function(){this.clearLevel.target+=10,this.showBoard.target+=7,this.wildcard.target+=5,this.extraTime.target+=3,this.extraMoves.target+=3,$("#clearLevel").attr("max",this.clearLevel.target),$("#wildcard").attr("max",this.wildcard.target),$("#showBoard").attr("max",this.showBoard.target),$("#extraTime").attr("max",this.extraTime.target),$("#extraMoves").attr("max",this.extraMoves.target)},fillBars:function(){this.clearLevel.current===this.clearLevel.target?this.clearLevel.full=!0:(this.clearLevel.current+=1,$("#clearLevel").val(this.clearLevel.current)),this.wildcard.current===this.wildcard.target?this.wildcard.full=!0:(this.wildcard.current+=1,$("#wildcard").val(this.wildcard.current)),this.showBoard.current===this.showBoard.target?this.showBoard.full=!0:(this.showBoard.current+=1,$("#showBoard").val(this.showBoard.current)),this.extraMoves.current===this.extraMoves.target?this.extraMoves.full=!0:(this.extraMoves.current+=1,$("#extraMoves").val(this.extraMoves.current)),this.extraTime.current===this.extraTime.target?this.extraTime.full=!0:(this.extraTime.current+=1,$("#extraTime").val(this.extraTime.current))},useBars:function(a){this[a].execute()}};$(document).ready(function(){$("#reset").hide(),$("#shuffle").hide();var a=function(){$("#start").click(function(){$(this).hide(),Memory.start(),$("#shuffle").show().click(function(a){a.stopPropagation(),Memory.shuffle()}).prop("disabled",!1),$("#reset").show().click(function(){Memory.start()}).prop("disabled",!0).css("opacity",".5")}),$('label[for="clearLevel"], label[for="wildcard"], label[for="showBoard"], label[for="extraTime"], label[for="extraMoves"]').click(function(){Memory.useBars($(this).attr("for"))})};$.ajax({url:"http://misd.info/assets/data.php",success:function(b){a()},error:function(){Memory.levels=[{type:"normal",numberOfTiles:4,levelMessage:"Clear the board!",targetMatches:2},{type:"normal",numberOfTiles:6,levelMessage:"Clear the board!",targetMatches:3},{type:"normal",numberOfTiles:8,levelMessage:"Clear the board!",targetMatches:4},{type:"normal",numberOfTiles:10,levelMessage:"Clear the board!",targetMatches:5},{type:"normal",numberOfTiles:12,levelMessage:"Clear the board!",targetMatches:6},{type:"time",targetSeconds:60,numberOfTiles:12,levelMessage:"Clear the board in 60 seconds!",targetMatches:6},{type:"moves",targetMoves:40,numberOfTiles:12,levelMessage:"Clear the board in 40 moves!",targetMatches:6},{type:"time",targetSeconds:60,numberOfTiles:14,levelMessage:"Clear the board in 60 seconds!",targetMatches:7},{type:"moves",targetMoves:40,numberOfTiles:14,levelMessage:"Clear the board in 40 moves!",targetMatches:7},{type:"moves",targetMoves:40,numberOfTiles:16,levelMessage:"Clear the board in 40 moves!",targetMatches:8}],a()},dataType:"json"})});